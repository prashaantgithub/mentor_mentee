{% extends "base.html" %}
{% block title %}Create New User{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Create New User</h1>
</div>
<div class="card">
    <form method="POST" action="{{ url_for('admin.create_user') }}" id="create-user-form">
        <div class="form-group">
            <label for="role">Role</label>
            <select id="role" name="role" class="form-control" required>
                <option value="mentee">Mentee</option>
                <option value="mentor">Mentor</option>
                <option value="admin">Admin</option>
            </select>
        </div>
        <div class="form-group">
            <label for="username">Username (ID Number)</label>
            <input type="text" id="username" name="username" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="name">Full Name</label>
            <input type="text" id="name" name="name" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" class="form-control" required>
        </div>
        
        <div id="mentor-fields" class="extra-fields" style="display:none;">
            <div class="form-group">
                <label for="department-mentor">Department</label>
                <input type="text" id="department-mentor" name="department" class="form-control">
            </div>
            <div class="form-group">
                <label for="expertise">Expertise</label>
                <input type="text" id="expertise" name="expertise" class="form-control">
            </div>
        </div>
        
        <div id="mentee-fields" class="extra-fields">
            <div class="form-group">
                <label for="department-mentee">Department</label>
                <input type="text" id="department-mentee" name="department" class="form-control">
            </div>
            <div class="form-group">
                <label for="semester">Semester</label>
                <input type="number" id="semester" name="semester" class="form-control">
            </div>
             <div class="form-group">
                <label for="gpa">Average GPA</label>
                <input type="number" step="0.01" id="gpa" name="gpa" class="form-control">
            </div>
            <div class="form-group">
                <label for="assigned_mentor">Assign a Mentor (Required)</label>
                <select id="assigned_mentor" name="assigned_mentor" class="form-control" required>
                    <option value="">-- Select a Mentor --</option>
                    {% for mentor in mentors %}
                    <option value="{{ mentor.id }}">{{ mentor.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary">Create User</button>
    </form>
</div>
{% endblock %}
{% block body_extra %}
<script>
document.getElementById('role').addEventListener('change', function() {
    var role = this.value;
    var mentorFields = document.getElementById('mentor-fields');
    var menteeFields = document.getElementById('mentee-fields');
    var mentorAssignmentField = document.getElementById('assigned_mentor');
    
    mentorFields.style.display = 'none';
    menteeFields.style.display = 'none';

    document.querySelectorAll('#mentor-fields input, #mentee-fields input, #mentee-fields select').forEach(input => input.disabled = true);

    if (role === 'mentor') {
        mentorFields.style.display = 'block';
        document.querySelectorAll('#mentor-fields input').forEach(input => input.disabled = false);
    } else if (role === 'mentee') {
        menteeFields.style.display = 'block';
        document.querySelectorAll('#mentee-fields input, #mentee-fields select').forEach(input => input.disabled = false);
    }
});
document.getElementById('role').dispatchEvent(new Event('change'));
</script>
{% endblock %}